[package]
name = "dm-database-sqllog2db"
version = "0.1.1"
edition = "2024"
description = "命令行工具：将达梦 SQL 日志解析并导出为 CSV 或嵌入式数据库 (SQLite)。"
homepage = "https://github.com/guangl/sqllog2db"
repository = "https://github.com/guangl/sqllog2db"
keywords = ["cli", "dm-database", "sqllog"]
categories = ["command-line-utilities"]
default-run = "sqllog2db"
license = "Apache-2.0"
readme = "README.md"
exclude = [
    "/examples/*",
    "/docs/*",
    "/.github/*",
    "/.vscode/*",
    "/scripts/*",
    "/logs/*",
    "/.gitignore",
    "/sqllogs/*",
    "/targets/*",
    "config.toml",
    "CHANGELOG.md",
]

[[bin]]
name = "sqllog2db"
path = "src/main.rs"

[dependencies]
dm-database-parser-sqllog = "0.4.0"
env_logger = "0.11.8"
once_cell = "1.21.3"
log = "0.4.28"
thiserror = "2.0.17"

clap = { version = "4.5.51", features = ["derive"] }
serde = { version = "1.0.228", features = ["derive"] }
toml = { version = "0.9.8", features = ["serde"] }

# 可选数据库依赖，通过 feature 启用
rusqlite = { version = "0.32.1", features = ["bundled"], optional = true }

# 可选功能依赖
anyhow = { version = "1.0.100", optional = true }
chrono = { version = "0.4.42", default-features = false, features = [
    "alloc",
], optional = true }
plotly = { version = "0.13.5", optional = true }

[dev-dependencies]
tempfile = "3.23.0"
rusqlite = { version = "0.32.1", features = ["bundled"] }

[features]
# 默认保持当前行为：启用 CSV 已实现的文件型数据库导出器
default = ["csv"]

# 各导出器特性开关
csv = []
sqlite = ["dep:rusqlite"]
dm = []

# 其他功能特性开关
replace_parameters = ["dep:rusqlite"]
scatter = ["dep:chrono", "dep:plotly", "dep:anyhow"]

[profile.release]
# 极致减小体积（可能牺牲一些运行时性能与构建时间）
opt-level = "z"                            # 尽可能小的代码体积
lto = true                                 # 跨 crate 链接时优化，减少重复代码
codegen-units = 1                          # 单 codegen 单元，提升整体优化效果
strip = true                               # 去除符号
panic = "abort"                            # 使用 abort 以避免展开栈的运行时代码
csv = { version = "1.3", optional = true }
