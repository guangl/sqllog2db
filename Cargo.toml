[package]
name = "dm-database-sqllog2db"
version = "0.1.1"
edition = "2024"
description = "命令行工具：将达梦 SQL 日志解析并导出为 CSV/JSONL 或嵌入式数据库 (SQLite/DuckDB)。"
homepage = "https://github.com/guangl/sqllog2db"
repository = "https://github.com/guangl/sqllog2db"
keywords = ["cli", "dm-database", "sqllog"]
categories = ["command-line-utilities"]
default-run = "sqllog2db"
license = "Apache-2.0"
readme = "README.md"
exclude = [
    "/examples/*",
    "/docs/*",
    "/.github/*",
    "/.vscode/*",
    "/scripts/*",
    "/logs/*",
    "/.gitignore",
    "/sqllogs/*",
    "/targets/*",
]

[[bin]]
name = "sqllog2db"
path = "src/main.rs"

[[bench]]
name = "performance"
path = "benches/performance.rs"
harness = false

[[bench]]
name = "profile"
path = "benches/profile.rs"
harness = false

[dependencies]
anyhow = "1.0.100"
chrono = "0.4"
clap = { version = "4.5.51", features = ["derive"] }
dm-database-parser-sqllog = { version = "0.3.0", features = ["serde"] }
once_cell = "1.21.3"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
thiserror = "2.0.17"
toml = { version = "0.9.8", features = ["serde"] }
tracing = "0.1.41"
tracing-appender = "0.2.3"
tracing-subscriber = { version = "0.3.20" }

# 可选数据库依赖，通过 feature 启用
duckdb = { version = "1.1.3", features = ["bundled"], optional = true }
rusqlite = { version = "0.32.1", features = ["bundled"], optional = true }

[dev-dependencies]
tempfile = "3.23.0"
duckdb = { version = "1.1.3", features = ["bundled"] }
rusqlite = { version = "0.32.1", features = ["bundled"] }

[features]
# 默认保持当前行为：启用 CSV 已实现的文件型数据库导出器
default = ["csv"]

# 各导出器特性开关
csv = []
jsonl = []
sqlite = ["dep:rusqlite"]
duckdb = ["dep:duckdb"]

# 预留的网络数据库导出器特性（当前未实现，编译几乎无体积）
postgres = []
oracle = []
dm = []

[profile.release]
# 极致减小体积（可能牺牲一些运行时性能与构建时间）
opt-level = "z"   # 尽可能小的代码体积
lto = true        # 跨 crate 链接时优化，减少重复代码
codegen-units = 1 # 单 codegen 单元，提升整体优化效果
strip = true      # 去除符号
panic = "abort"   # 使用 abort 以避免展开栈的运行时代码
